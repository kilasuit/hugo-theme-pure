(function(){"use strict";const e={STORAGE_KEY:"bionic-reading-enabled",CONTENT_LOAD_DELAY:100,contentSelector:".article-entry",getBoldLength:function(e){return e<=1?1:e<=3?1:e<=5?2:e<=8?3:Math.ceil(e/2)},processTextNode:function(e){const n=e.textContent;if(!n.trim())return;const s=n.split(/(\s+)/),t=document.createDocumentFragment();s.forEach(e=>{if(!e)return;if(/^\s+$/.test(e)){t.appendChild(document.createTextNode(e));return}const n=e.match(/^([^\w]*)(\w+)([^\w]*)$/);if(n){const[,i,s,a]=n;i&&t.appendChild(document.createTextNode(i));const r=this.getBoldLength(s.length),l=s.substring(0,r),c=s.substring(r),e=document.createElement("span");e.className="bionic-word";const o=document.createElement("span");o.className="bionic-bold",o.textContent=l,e.appendChild(o),c&&e.appendChild(document.createTextNode(c)),t.appendChild(e),a&&t.appendChild(document.createTextNode(a))}else t.appendChild(document.createTextNode(e))}),e.parentNode.replaceChild(t,e)},processElement:function(e){const s=document.createTreeWalker(e,NodeFilter.SHOW_TEXT,{acceptNode:function(e){const t=e.parentElement;if(!t)return NodeFilter.FILTER_REJECT;const n=t.tagName.toLowerCase();return["code","pre","script","style","textarea"].includes(n)?NodeFilter.FILTER_REJECT:t.classList&&t.classList.contains("bionic-word")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}}),t=[];let n;for(;(n=s.nextNode())!==null;)t.push(n);t.forEach(e=>this.processTextNode(e))},removeFormatting:function(e){const t=e.querySelectorAll(".bionic-word");t.forEach(e=>{const t=e.textContent,n=document.createTextNode(t);e.parentNode.replaceChild(n,e)}),e.normalize()},enable:function(){const e=document.querySelector(this.contentSelector);if(!e)return;if(e.classList.contains("bionic-reading-enabled"))return;this.processElement(e),e.classList.add("bionic-reading-enabled"),localStorage.setItem(this.STORAGE_KEY,"true");const t=document.querySelector(".bionic-toggle");t&&(t.classList.add("active"),t.setAttribute("aria-pressed","true"))},disable:function(){const e=document.querySelector(this.contentSelector);if(!e)return;this.removeFormatting(e),e.classList.remove("bionic-reading-enabled"),localStorage.setItem(this.STORAGE_KEY,"false");const t=document.querySelector(".bionic-toggle");t&&(t.classList.remove("active"),t.setAttribute("aria-pressed","false"))},toggle:function(){const e=document.querySelector(this.contentSelector);if(!e)return;e.classList.contains("bionic-reading-enabled")?this.disable():this.enable()},isEnabled:function(){return localStorage.getItem(this.STORAGE_KEY)==="true"},init:function(){this.isEnabled()&&setTimeout(()=>this.enable(),this.CONTENT_LOAD_DELAY);const e=document.querySelector(".bionic-toggle");e&&(e.addEventListener("click",()=>this.toggle()),this.isEnabled()&&(e.classList.add("active"),e.setAttribute("aria-pressed","true")))}};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>e.init()):e.init()})()